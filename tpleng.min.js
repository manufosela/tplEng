TplEng=function(){return TplEng=function(t){t=t||{},this.path=t.path||"./",this.popup=new Popup||!1,this.pathjs=this.path+t.pathjs,this.pathtpl=this.path+t.pathtpl},TplEng.prototype.applyHTMLTpl=function(t){for(var n=t.html||"<!-- ARG HTML EMPTY -->",e=t.params||{},l=t.callback||function(){},o=/<%([^%>]+)?%>/g,a=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,c="var h=[];\n",p=0,i=function(t,n){return c+=n?t.match(a)?t+"\n":"h.push( "+t+" );\n":""!==t?'h.push( "'+t.replace(/"/g,'\\"')+'" );\n':"",i};match=o.exec(n);)i(n.slice(p,match.index))(match[1],!0),p=match.index+match[0].length;i(n.substr(p,n.length-p)),c+='return h.join( "" );';var r=new Function(c.replace(/[\r\t\n]/g,"").replace(/[\s\s]/g," ")).apply(e);return l(r),r},TplEng.prototype.applyTplIntoDOM=function(t){var n=t.domid||null,e=t.html||"<!-- ARG HTML EMPTY -->",l=t.params||{},o=t.nocache||!1,a=t.callback||function(){},c=this;this.applyHTMLTpl({html:e,params:l,callback:function(t){var e=document.getElementById(n);null!==e?(e.innerHTML=t,c.searchTpl({html:t,domid:n,nocache:o}),a()):c.debug&&console.error("domid "+n+" no encontrado")}})},TplEng.prototype.loadTpl=function(t){if("undefined"!=typeof t.tplname&&"undefined"!=typeof t.domid){var n=null!==t.domid?document.getElementById(t.domid):null;null!==n&&(n.innerHTML="Cargando...");var e=t.tplname,l=t.domid,o=t.params||{},a=t.nocache||!1,c=t.callback||function(){},p=this,i=function(){var t=null!==l?document.getElementById(l):null;c(),null!==t&&(t.style.display="block")},r=function(t){p.applyTplIntoDOM({domid:l,html:t,params:o}),p.include(p.pathjs+e+".js?"+nocacheStr,i)};nocacheStr=a===!0?"?"+(new Date).getTime():"",this.include(this.pathtpl+e+".html"+nocacheStr,r)}else console&&console.error("Error in loadTpl arguments")},TplEng.prototype.searchTpl=function(t){for(var n,e,l,o,a=t.html,c=t.domid,p=t.nocache,i=p===!0?"?"+(new Date).getTime():"",r=/\{\{\!(\w*)\}\}/g,h=this,s=function(t){o=document.getElementById(c).innerHTML,document.getElementById(c).innerHTML=o.replace(e,t),include(h.pathjs+l+".js"+i)};n=r.exec(a);)e=n[0],l=n[1],this.include(h.pathtpl+l+".html"+i,s)},TplEng.prototype.include=function(t,n){n=n||function(){};var e,l=document.location.protocol+"//"+document.location.host+t,o=~l.split("?")[0].split("#")[0].search(/.js$/)?"script":"text";return t.length>0?(e=$.ajax({dataType:o,url:l,data:{}}).complete(function(t){var e=t.responseText;n(e,o)}),{code:0,msg:"PROCESSING"}):{code:1,msg:"<h3>ERROR LOADING INCLUDE<h3>"}},TplEng}();
