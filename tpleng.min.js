TplEng=function(){return TplEng=function(e){e=e||{},this.path=e.path||"./",this.popup=new Popup||!1,require.config({paths:{path:this.path,templatePath:this.path}})},TplEng.prototype.applyHTMLTpl=function(e){for(var n=e.html||"<!-- ARG HTML EMPTY -->",t=e.params||{},l=e.callback||function(){},o=/<%([^%>]+)?%>/g,a=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,r="var h=[];\n",c=0,p=function(e,n){return r+=n?e.match(a)?e+"\n":"h.push( "+e+" );\n":""!==e?'h.push( "'+e.replace(/"/g,'\\"')+'" );\n':"",p};match=o.exec(n);)p(n.slice(c,match.index))(match[1],!0),c=match.index+match[0].length;p(n.substr(c,n.length-c)),r+='return h.join( "" );';var i=new Function(r.replace(/[\r\t\n]/g,"").replace(/[\s\s]/g," ")).apply(t);return l(i),i},TplEng.prototype.applyTplIntoDOM=function(e){var n=e.domid||null,t=e.html||"<!-- ARG HTML EMPTY -->",l=e.params||{},o=e.nocache||!1,a=this;this.applyHTMLTpl({html:t,params:l,callback:function(e){var t=document.getElementById(n);null!==t?(t.innerHTML=e,a.searchTpl({html:e,domid:n,nocache:o})):a.debug&&console.error("domid "+n+" no encontrado")}})},TplEng.prototype.loadTpl=function(e){if(require&&"undefined"!=typeof e.tplname&&"undefined"!=typeof e.domid){var n=null!==e.domid?document.getElementById(e.domid):null;null!==n&&(n.innerHTML="Cargando...");var t=e.tplname,l=e.domid,o=e.params||{},a=e.nocache||!1,r=e.callback||function(){},c=this,p=function(e){console.warn(e)},i=function(){r();var e=null!==l?document.getElementById(l):null;null!==e&&(e.style.display="block")},u=function(e){c.applyTplIntoDOM({domid:l,html:e,params:o}),require(["tpljs/"+t+".js?a=1&"+nocacheStr],i,p)};nocacheStr=a===!0?"?"+(new Date).getTime():"",require(["text!templatePath/tpl/"+t+".html"+nocacheStr],u,p)}else console&&console.error("RequireJS is not loaded")},TplEng.prototype.searchTpl=function(e){for(var n,t,l,o,a=e.html,r=e.domid,c=e.nocache,p=c===!0?"?"+(new Date).getTime():"",i=/\{\{\!(\w*)\}\}/g,u=function(e){o=document.getElementById(r).innerHTML,document.getElementById(r).innerHTML=o.replace(t,e),require(["./tpljs/"+l+".js"+p])},h=function(e){console.warn(e)};n=i.exec(a);)t=n[0],l=n[1],require(["text!tpl/"+l+".html"+p],u,h)},TplEng}();
